# pnpm의 캐시 관리 특징

## 1. 캐시 시스템 개요

pnpm은 두 가지 주요 캐시 메커니즘을 사용합니다:

1. **Content-addressable 스토어**

   - 전역 저장소에 패키지를 한 번만 저장
   - 파일의 내용을 기반으로 한 해시값으로 저장
   - 모든 프로젝트가 공유하여 사용

2. **메타데이터 캐시**
   - 패키지 정보, 의존성 트리 등의 메타데이터 저장
   - 빠른 의존성 해석을 위해 사용
   - registry 요청 최소화

## 2. 캐시 실험

### 2.1 실험 설정

```json
{
  "name": "cache-experiment",
  "version": "1.0.0",
  "dependencies": {
    "react": "^18.3.1",
    "lodash": "^4.17.21"
  }
}
```

### 2.2 실험 단계

1. **초기 설치 시간 측정**

   ```bash
   time pnpm install
   ```

2. **node_modules 삭제 후 재설치 시간 측정**

   ```bash
   rm -rf node_modules
   time pnpm install
   ```

3. **캐시 삭제 후 설치 시간 측정**
   ```bash
   pnpm store prune
   time pnpm install
   ```

### 2.3 실험 결과

1. 초기 설치:

   - 패키지 다운로드 필요
   - 메타데이터 캐시 생성
   - 가장 긴 설치 시간

2. 캐시된 재설치:

   - 다운로드 없음
   - 하드링크만 생성
   - 매우 빠른 설치 시간

3. 캐시 삭제 후:
   - 패키지 재다운로드 필요
   - 초기 설치와 유사한 시간

## 3. 캐시 관리 명령어

### 3.1 캐시 정보 확인

```bash
# 캐시 위치 확인
pnpm store path

# 캐시 상태 확인
pnpm store status

# 캐시된 패키지 목록
pnpm store list
```

### 3.2 캐시 관리

```bash
# 사용하지 않는 패키지 제거
pnpm store prune

# 특정 패키지 캐시 제거
pnpm store remove <package>

# 캐시 무결성 검사
pnpm store verify
```

## 4. 장점

1. **디스크 공간 효율성**

   - 동일 패키지는 시스템에 한 번만 저장
   - 여러 프로젝트가 캐시 공유

2. **설치 속도**

   - 캐시된 패키지는 즉시 사용 가능
   - 네트워크 요청 최소화
   - 하드링크를 통한 빠른 설치

3. **오프라인 지원**
   - 캐시된 패키지로 오프라인 설치 가능
   - CI/CD 환경에서 안정적인 빌드

## 5. 모범 사례

1. **캐시 관리**

   - 정기적인 `pnpm store prune` 실행
   - 캐시 무결성 주기적 검사

2. **CI/CD 최적화**

   - 캐시 활용으로 빌드 시간 단축
   - 적절한 캐시 정책 설정

3. **오프라인 작업**
   - 필요한 패키지 미리 캐시
   - 네트워크 의존성 최소화
